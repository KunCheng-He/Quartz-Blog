> [!quote] 友善R5C相关资料
> [官方文档](https://wiki.friendlyelec.com/wiki/index.php/NanoPi_R5C/zh)  [简单介绍与测试](https://www.youtube.com/watch?v=BCJpVTNgKXM)  [iStoreOS固件下载](https://fw.koolcenter.com/iStoreOS/r5s/)  [iStoreOS一些插件下载仓库](https://github.com/AUK9527/Are-u-ok)

# 0 从0安装iStoreOS

首先需要准备工具，在这下载[Rufus](https://rufus.ie/zh/)标准版即可，用来后续写入镜像文件。而镜像文件在[iStoreOS固件下载](https://fw.koolcenter.com/iStoreOS/r5s/)处下载最新的镜像即可。完成后插入SD卡开始写入镜像
![[Pasted image 20240320133201.png]]

完成以上操作后，将网线接在 `WAN` 口，插入 `TF` 卡和电源，设备就开始运行了，等待一分钟，进入路由器界面查看该设备的 `IP` 地址
![[Pasted image 20240320150035.png]]

查看到对应的 `IP` 地址就可以访问了
> [!warning] 通过IP连接失败
> 如果连接失败，可以将网线一端插入 LAN 口，另一端连接到电脑，这时通过官方文档中的 192.168.100.1 既可以访问到 ，进入后首先配置 IP 地址，配置完成后，拔下笔记本这一端，插入路由器的 LAN 口即可。

通过网络向导直接配置**旁路由**即可，高级选项里仅勾选**NAT**，记得更改管理员密码

# 1 旁路由魔法

## 1.0 选择软路由的原因

🔱 实现魔法的方式比较多，像电脑上安装 `Clash_for_Window` ，手机安装 `Clash` 等方式，然后添加机场订阅，这些都可以归为 **软件翻墙** ，局限就在于有一些软件的网络流量仍然是无法走代理的；还可以通过路由器直接实现翻墙，这一类归为 **硬件翻墙**，这种方式算是实现了透明代理，只要连接了该路由器的设备，其所有浏览我们都可以很容易的使其通过代理，但因为代理需要对流量进行加密运算，一些路由器设计之初就没有考虑让路由器做这些运算，所以这些路由器的算力低，这些运算就会消耗不少资源，最终导致带宽跑不满；第三类就是 **网关翻墙** 

+ 🫠 我的需求其实很简单，就算放到家庭网络中，大部分设备也是不需要魔法的，只需要正常上网就行，所以我希望我的网络对他们不要产生影响
+ 不选择硬件翻墙的原因也很简单，我不希望客人一来，连上 WiFi ，就让客人也能翻墙
+ 所以，使用旁路由，让其做一个网关服务器，需要魔法的设备在连接主路由WIFI后将网关修改到旁路有即可，这样的方式不影响正常设备，怎么折腾都可以

 ![[Pasted image 20230703214142.png]]
 > PC1 不需要魔法上网，连接主路由后正常上网即可，PC2 需要魔法上网，将其网关配置为旁路由的 IP地址，这样访问外网时，网络数据流量发送到默认网关，即旁路由，旁路由提供魔法服务，再经由主路由实现访问

## 1.1 遇到的问题

### 1.1.0 WIFI设备无法上网

> 现在该问题在 `iStoreOS` 的网络向导里，进行手动设置时会让你勾选一个选项，用来解决该问题

❓ 正常设置完成后，通过 `WIFI` 连接到主路由的设备，其网关和DNS服务地址都改为了旁路由，无法正常访问国内网站，可以访问国外网站；使用网线连接到主路由的设备，网关修改后，一些服务正常

该问题的详细解释在 [这篇博客](https://cloud.tencent.com/developer/article/2036952)，我只看懂了一半，大概意思是通过 WIFI 连接的设备，其数据包第一次到达主路由时，主路由对其进行 NAT，然后发给了旁路由，旁路由处理后并没有修改数据包中的一些地址，直接又发给主路由，主路由一看，该数据包在 NAT 里有记录，直接就又发给了旁路由，待 TTL 为0后，该数据包就丢失了

而通过网线连接的设备，其数据直接发送到了旁路由上，没有经过主路由处理，旁路由处理后发给主路由，这是主路由第一次对该数据包做 NAT，做完后就转到 WAN 口发送到公网中去了，从而也就正常上网了

以下是我在 H3C NX30Pro 里根据上面那篇博客执行的结果

![[Pasted image 20230702180512.png]]

✅ 最后我的解决办法如下，勾上 IP动态伪装后，保存并应用即可

![[Pasted image 20230703220400.png]]

### 1.1.1 魔法后国内网站无法访问

❌ 我也不知道为啥，参考网络上的办法，在 `系统-启动项` 中禁用 `firewall`

![[Pasted image 20231108145901.png]]

# 2 NAS用途

> [!important] 不建议🚫
> 通过 `R5C` 上的 `USB` 口外挂移动硬盘，不建议长期这样使用，网络上说数据容易出问题，我暂时还没遇到，不过也不敢存重要数据，**NAS**还是专用的机器来做吧

 该用途没遇到什么坑，只是移动硬盘的格式仅支持 `EXT4`，但是 `Windows` 是不支持将硬盘格式化为该格式的，这时候可以参考这篇[CSDN博客](https://blog.csdn.net/weixin_48717635/article/details/132305029)，下载[DiskGenius](https://www.diskgenius.cn/download.php)格式化硬盘即可。最后在 `iStoreOS` 插件商店里安装所需要用到的插件即可，推荐安装 `istorex` 这个插件，然后使用**NAS向导**即可
 ![[Pasted image 20240321103739.png]]
